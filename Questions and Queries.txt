-- Solve the below SQL problems using the Famous Paintings & Museum dataset:



1) Fetch all the paintings which are not displayed on any museums?

SELECT * 
FROM public.work
where museum_id is null limit 7


The SQL query retrieves distinct rows from the "work" table where the "museum_id" is null, limiting the output to 7 rows. This indicates artworks in the dataset lacking museum affiliations, suggesting incomplete museum information for these specific artworks.


2) Are there museuems without any paintings?


SELECT
    m.name AS museum_name,
    COUNT(w.work_id) AS num_paintings
FROM
    public.museum m
LEFT JOIN
    public.work w
ON
    m.museum_id = w.museum_id
GROUP BY
    m.name
HAVING
    COUNT(w.work_id) = 0



3) How many paintings have an asking price of more than their regular price? 

SELECT * FROM public.product_size
where regular_price > sale_price


The provided data seems to represent pricing information for different sizes of a particular artwork (identified by "work_id"). Each row corresponds to a specific size variant ("size_id") of the artwork, with corresponding sale prices ("sale_price") and regular prices ("regular_price").

For instance, for artwork with ID 125752:

Size variant 3024 has a sale price of 305 and a regular price of 535.
Size variant 3226 has a sale price of 325 and a regular price of 575.
Size variant 3629 has a sale price of 375 and a regular price of 675.
Size variant 4030 has a sale price of 405 and a regular price of 735.
Size variant 4836 has a sale price of 495 and a regular price of 915.
Size variant 6048 has a sale price of 675 and a regular price of 1275.
This data allows for analyzing pricing strategies, discounts, and variations in pricing based on size for the given artwork.




4) Identify the paintings whose asking price is less than 50% of its regular price

SELECT work_id, sale_price, regular_price FROM public.product_size
where sale_price < (regular_price * 0.50)



The SQL query retrieves data from the "product_size" table where the sale price is less than 50% of the regular price, limiting the output to 6 rows. This indicates artworks with significant discounts applied relative to their regular prices.

For example:

Artwork with ID 31780 has sale prices of 10 and regular prices of 125 and 95.
Artwork with ID 198417 has sale prices of 30 and regular prices of 125 and 95.
This data suggests artworks that are heavily discounted, potentially reflecting promotional offers or clearance sales for these particular items.



5) Which canva size costs the most?

SELECT max(p.sale_price) FROM public.canvas_size c
join public.product_size p
on c.size_id = p.size_id



The SQL query retrieves the maximum sale price across all canvas sizes by joining the "canvas_size" table with the "product_size" table based on their shared "size_id" and limits the output to 5 rows.

The result shows that the maximum sale price among the canvas sizes is 1115.





6) Delete duplicate records from work, product_size, subject and image_link tables


finding the duplicates------

SELECT
    work_id, count(work_id) as c
FROM
    public.work
GROUP BY
    work_id
HAVING
    COUNT(work_id)> 1
ORDER BY
    c desc;
	


SELECT
    work_id, count(work_id) as c
FROM
    public.subject
GROUP BY
    work_id
HAVING
    COUNT(work_id)> 1
ORDER BY
    c desc;
	
	
	

SELECT
    work_id, count(work_id) as c
FROM
    public.product_size
GROUP BY
    work_id
HAVING
    COUNT(work_id)> 1
ORDER BY
    c desc;
	
	
	

SELECT
    work_id, count(work_id) as c
FROM
    public.image_link
GROUP BY
    work_id
HAVING
    COUNT(work_id)> 1
ORDER BY
    c desc;
	
	
---------------------------


delete from work 
	where ctid not in (select min(ctid)
						from work
						group by work_id );

	delete from product_size 
	where ctid not in (select min(ctid)
						from product_size
						group by work_id, size_id );

	delete from subject 
	where ctid not in (select min(ctid)
						from subject
						group by work_id, subject );

	delete from image_link 
	where ctid not in (select min(ctid)
						from image_link
						group by work_id );






7) Identify the museums with invalid city information in the given dataset


DELETE FROM public.museum
WHERE city ~ '\d';


select city from public.museum
where city ~ '.'



8) Museum_Hours table has 1 invalid entry. Identify it and remove it.


delete from public.museum_hours 
	where ctid not in (select min(ctid)
						from museum_hours
						group by museum_id, day );


9) Fetch the top 10 most famous painting subject

select style, count(style) as c from public.work
group by style
order by count(style) desc
limit 10


The SQL query retrieves the top 10 artistic styles represented in the "work" table along with the count of artworks associated with each style, ordered by the count of artworks in descending order.

The result shows:

"Impressionism" is the most common style with 3078 artworks.
Followed by "Post-Impressionism" with 1672 artworks.
Then "Realism" with 1179 artworks.
Subsequently, "Baroque" with 969 artworks.
And so forth for the other styles listed.




10) Identify the museums which are open on both Sunday and Monday. Display museum name, city.

SELECT m.museum_id, m.name, m.city, mh.day, mh.open, mh.close from 
public.museum_hours mh
join public.museum m
on m.museum_id = mh.museum_id
where day = 'Sunday' or day = 'Monday'


The SQL query selects museum information and their operating hours for Sundays and Mondays, limited to the first 5 results. This provides insights into museums' schedules on these days:
The Museum of Modern Art in New York opens at 10:30 AM and closes at 5:30 PM on both Sundays and Mondays.
The Pushkin State Museum of Fine Arts in Moscow opens at 11:00 AM and closes at 6:00 PM on both Sundays and Mondays.
The National Gallery of Victoria in Melbourne opens at 10:00 AM and closes at 5:00 PM on Sundays. The data does not provide information for Mondays.


11) How many museums are open every single day?4

with c1 as
(
(select museum_id, count(day) as d
from public.museum_hours
group by museum_id
having count(day) = 7)
)


select m.name, m.city from public.museum m
join c1 on c1.museum_id = m.museum_id




-- WITH DaysOpen AS (
--     SELECT mh.museum_id, COUNT(DISTINCT mh.day) AS days_open
--     FROM museum_hours mh
--     GROUP BY mh.museum_id
--     HAVING COUNT(DISTINCT mh.day) = 7
-- )
-- SELECT m.name, m.city
-- FROM museum m
-- JOIN DaysOpen d ON m.museum_id = d.museum_id;



The query output lists the names and cities of museums that operate every day of the week (7 days):

"The Museum of Modern Art" in New York
"Pushkin State Museum of Fine Arts" in Moscow
"National Gallery of Victoria" in Melbourne
"The Metropolitan Museum of Art" in New York
"National Maritime Museum" in London
"Rijksmuseum" in Amsterdam



12) Which are the top 5 most popular museum? (Popularity is defined based on most no of paintings in a museum)

with cte as 
-- (select museum_id
(select count(work_id) as c, museum_id
from public.work
where museum_id is not null
group by museum_id
order by count(work_id) desc limit 5
)

select m.name, m.city, m.country, cte.c as no_of_paintings
from public.museum m
join cte 
on cte.museum_id = m.museum_id



The data represents the names, cities, countries, and the number of paintings for several museums:

The Metropolitan Museum of Art in New York, USA, with 938 paintings.
Rijksmuseum in Amsterdam, Netherlands, with 451 paintings.
National Gallery of Art in Washington, USA, with 375 paintings.
National Gallery in London, UK, with 423 paintings.
The Barnes Foundation in Philadelphia, USA, with 350 paintings.



13) Who are the top 5 most popular artist? (Popularity is defined based on most no of paintings done by an artist)



with cte as 
-- (select museum_id
(select count(work_id) as c, artist_id
from public.work
where artist_id is not null
group by artist_id
order by count(work_id) desc limit 5
)

select m.full_name, m.style, cte.c as no_of_paintings
from public.artist m
join cte 
on cte.artist_id = m.artist_id



The provided data presents the full names of artists alongside their respective 
artistic styles and the number of paintings attributed to each artist. Notably, Pierre-Auguste Renoir 
and Claude Monet, both renowned Impressionist painters, exhibit the highest number of paintings 
in the dataset, with 469 and 378 works, respectively. Albert Marquet and Vincent Van Gogh, 
recognized for their Post-Impressionist contributions, follow closely with 233 and 308 paintings. 
Maurice Utrillo, known for his Realist style, presents 253 paintings in the dataset.



14) Display the 3 least popular canva sizes


by sales -------------------

with c1 as
(
	select round(size_id) as size_id, sum(sale_price)  as s
	from public.product_size
	group by size_id
-- 	order by s asc limit 3
)

select cs.label, cs.size_id, c1.s
from public.canvas_size cs
join c1
on c1.size_id = cs.size_id
order by c1.s asc




The SQL query retrieves the top 10 canvas sizes represented in the "canvas_size" table along with the count of occurrences for each size, ordered by count in descending order.

The result shows:

"24 x 29(61 cm x 74 cm)" is the most common size with 265 occurrences.
Followed by "31 x 24(79 cm x 61 cm)" and "29 x 22(74 cm x 56 cm)" with 255 occurrences each.
Then "24 x 20(61 cm x 51 cm)" with 245 occurrences.
Subsequently, "20 Long Edge", "22 x 27(56 cm x 69 cm)", and "24 x 18(61 cm x 46 cm)" each with 225 occurrences.
And so forth for the other sizes listed.


by count ------------

wITH PopularityCTE AS (
    SELECT 
        ps.size_id,
        COUNT(*) AS sales_count -- or another metric like SUM(sale_price) for total sales value
    FROM 
        public.product_size ps
    GROUP BY 
        ps.size_id
)
SELECT 
    cs.label,
    p.sales_count
FROM 
    PopularityCTE p
JOIN 
    public.canvas_size cs ON p.size_id = cs.size_id
ORDER BY 
    p.sales_count ASC
LIMIT 3;

The SQL query provides insight into the top 10 canvas sizes sold, listed along with their respective sales counts.

The result indicates:

"37 x 30(94 cm x 76 cm)" has 1 sale.
"36 x 27(91 cm x 69 cm)" has 1 sale.
"32 x 46(81 cm x 117 cm)" has 1 sale.
"24 x 29(61 cm x 74 cm)" has 1 sale.
"32 x 18(81 cm x 46 cm)" has 1 sale.
"44 x 34(112 cm x 86 cm)" has 1 sale.



15) Which museum is open for the longest during a day. Dispay museum name, state and hours open and which day?


SELECT
    m.name AS museum_name,
    m.state,
    oh.open,
    oh.day
FROM
    public.museum m
JOIN
    public.museum_hours oh
ON
    m.museum_id = oh.museum_id
WHERE m.state is not null
ORDER BY
    oh.open DESC
LIMIT 1


The information provided shows that the "Museum of Fine Arts, Houston" in Texas (TX) opens at 12:30:00 on Sundays. 
This data gives a specific insight into the opening time of the museum on Sundays in Houston.




16) Which museum has the most no of most popular painting style?


select m.name, style, count(style) as st
from public.work w
join public.museum m
on m.museum_id = w.museum_id
group by style, m.name
order by st desc


The data provided showcases the names of museums along with the predominant artistic style exhibited and the corresponding count of artworks representing each style.

Here's the breakdown:

"The Metropolitan Museum of Art" predominantly features "Impressionism" with 244 artworks.
"The Barnes Foundation" also emphasizes "Impressionism" with 222 artworks.
"Rijksmuseum" showcases "Baroque" art with 173 artworks.
"Musée d'Orsay" focuses on "Impressionism" with 158 artworks.
"National Gallery" displays primarily "Baroque" art with 139 artworks.
"National Gallery of Art" presents "Impressionism" with 116 artworks.
These insights provide an overview of the dominant artistic styles exhibited in various renowned museums along with the corresponding counts of artworks for each style.



17) Identify the artists whose paintings are displayed in multiple countries


select distinct a.full_name, count( distinct m.country) as country
from public.work w
join public.museum m
on w.museum_id = m.museum_id
join public.artist a
on a.artist_id = w.artist_id
group by a.full_name
order by country desc limit 5


The SQL query retrieves the top 5 artists based on the count of distinct countries where their artworks are exhibited. Here's the breakdown:

Vincent Van Gogh's artworks are displayed in 7 distinct countries.
Claude Monet and Paul Gauguin's artworks are exhibited in 6 distinct countries each.
Camille Pissarro and Edgar Degas's artworks are showcased in 5 distinct countries each.
These results provide insight into the international reach and popularity of these artists' works across various countries.



18) Display the country and the city with most no of museums. Output 2 seperate columns to mention the city and country. If there are multiple value, seperate them with comma.


with c1 as
(select country, city, count(distinct museum_id) as cnt
from public.museum
group by city, country
-- order by cnt desc
)

select country, STRING_AGG(city, ',') as city
from c1
group by country
-- order by cnt desc



select country, STRING_AGG(city, ',') as citry
from public.museum
group by country
order by count(*) desc
limit 1



19) Identify the artist and the museum where the most expensive and least expensive painting is placed. Display the artist name, sale_price, painting name, museum name, museum city and canvas label

most expensive ---------

select a.full_name as artist_name, p.sale_price, 
w.name as painting_name, m.name as museum_name, m.city as musuem_city, c.label
from public.work w
join public.artist a on a.artist_id = w.artist_id
join public.product_size p on p.work_id = w.work_id
join public.museum m on m.museum_id = w.museum_id
join public.canvas_size c on c.size_id = p.size_id
group by artist_name, w.name, m.name, m.city, c.label, p.sale_price
order by p.sale_price desc limit 1


The provided SQL query retrieves details about the most expensive painting, including the artist's name, sale price, painting name, museum name, museum city, and canvas size label.

Here's the breakdown:

Artist Name: Peter Paul Rubens
Sale Price: $1115
Painting Name: "Fortuna"
Museum Name: The Prado Museum
Museum City: Madrid
Canvas Size Label: "48 x 96(122 cm x 244 cm)"
This information highlights the most expensive painting attributed to Peter Paul Rubens, housed in The Prado Museum located in Madrid, and its corresponding canvas size label.




least expensive -------------
select a.full_name as artist_name, p.sale_price, 
w.name as painting_name, m.name as museum_name, m.city as musuem_city, c.label
from public.work w
join public.artist a on a.artist_id = w.artist_id
join public.product_size p on p.work_id = w.work_id
join public.museum m on m.museum_id = w.museum_id
join public.canvas_size c on c.size_id = p.size_id
group by artist_name, w.name, m.name, m.city, c.label, p.sale_price
order by p.sale_price asc limit 1


The provided SQL query retrieves details about the least expensive painting, including the artist's name, sale price, painting name, museum name, museum city, and canvas size label.

Here's the breakdown:

Artist Name: Adélaïde Labille-Guiard
Sale Price: $10
Painting Name: "Portrait of Madame Labille-Guyard and Her Pupils"
Museum Name: The Metropolitan Museum of Art
Museum City: New York
Canvas Size Label: "30 Long Edge"

This information highlights the least expensive painting attributed to Adélaïde Labille-Guiard, housed in The Metropolitan Museum of Art located in New York, and its corresponding canvas size label.



20) Which country has the 5th highest no of paintings?

SELECT
    m.country,
    COUNT(w.work_id) AS num_paintings
FROM
    public.museum m
JOIN
    public.work w
ON
    m.museum_id = w.museum_id
GROUP BY
    m.country
ORDER BY
    num_paintings DESC
LIMIT 1 OFFSET 4;
-- limit 10


The SQL query retrieves the country with the fourth-highest number of paintings exhibited in museums. Here's the breakdown:

Spain has 196 paintings exhibited in its museums, ranking fourth in terms of the number of paintings.
This insight sheds light on the significant presence of artworks within Spanish museums, indicating a rich cultural heritage and vibrant art scene within the country.



21) Which are the 3 most popular and 3 least popular painting styles?


select style, count(style) as c
from public.work
where style is not null
group by style
order by c desc
limit 3


The provided SQL query retrieves the top 3 artistic styles represented in the "work" table, along with the count of artworks associated with each style, ordered by the count of artworks in descending order.

The resulting output showcases:

"Impressionism" as the most common style with 3078 artworks.
"Post-Impressionism" follows with 1672 artworks.
"Realism" ranks third with 1179 artworks.

This breakdown offers valuable insights into the distribution of artistic styles within the dataset, emphasizing the prevalence of Impressionism followed by Post-Impressionism and Realism




select style, count(style) as c
from public.work
where style is not null
group by style
order by c asc
limit 3

The SQL query fetches the top 3 artistic styles represented in the "work" table, along with the count of artworks associated with each style, ordered by the count of artworks in ascending order. The result indicates:

"Avant-Garde" is the most prevalent style with 146 artworks.
Following that is "Art Nouveau" with 108 artworks.
Lastly, "Japanese Art" is represented with 70 artworks.

These insights provide a glimpse into the distribution of artistic styles within the dataset, highlighting the prominence of Avant-Garde, Art Nouveau, and Japanese Art.


22) Which artist has the most no of Portraits paintings outside USA?. Display artist name, no of paintings and the artist nationality.


select a.full_name, a.nationality, count(1) as no_of
from public.work w
join public.artist a on a.artist_id = w.artist_id
join public.subject s on s.work_id = w.work_id
join public.museum m on m.museum_id = w.museum_id
where s.subject = 'Portraits' and m.country != 'USA'
group by a.nationality, a.full_name
order by no_of desc limit 5



The provided SQL query retrieves the top 5 artists who have created portraits exhibited in museums outside of the USA, along with their respective nationalities and the count of portraits attributed to each artist.

The result showcases:

Adriaan De Lelie, Bartholomeus Van Der Helst, Frans Hals, Jan Adam Kruseman, and Anton Raphael Mengs, each known for their significant contributions to portraiture.
Adriaan De Lelie, a Dutch artist, leads with 13 portraits.
Followed closely by Bartholomeus Van Der Helst and Frans Hals, also Dutch, with 12 and 10 portraits respectively.
Jan Adam Kruseman, another Dutch artist, and Anton Raphael Mengs, a German artist, both have 10 portraits attributed to them.


These insights provide valuable information about prominent portrait artists and their works exhibited in museums outside of the USA.